pipeline {
  agent any
  options {
    skipDefaultCheckout(true)
  }

  stages {
    stage('Code checkout from GitHub') {
      steps {
        script {
          cleanWs()
          git credentialsId: 'github-token', url: 'https://github.com/AdamKazmierczak/abcd-student', branch: 'develop'
        }
      }
    }

    stage('ZAP Scan') {
      steps { 
               // sh 'trufflehog git file://. --since-commit develop --branch HEAD --fail --no-update'
              sh '  trufflehog git file://. --branch main --fail'
            }
      }
    }
  }

  post {
    always {

      defectDojoPublisher(
        artifact: '/tmp/abcd-student-Reports/zap_xml_report.xml',
        productName: 'Juice Shop',
        scanType: 'ZAP Scan',
        engagementName: 'adaml.kazmierczak@gmail.com'
      )
    }
  }



